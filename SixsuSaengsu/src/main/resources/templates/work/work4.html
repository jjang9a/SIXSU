<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
 	layout:decorate="~{layout/template}">
<head>
<meta charset="UTF-8">
<title>신규</title>
<!-- 토스트~ -->
<link rel="stylesheet" href="https://uicdn.toast.com/tui-grid/latest/tui-grid.css" />
<!-- 부트스트라프 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<!-- 제이쿼리 -->
<script src="https://code.jquery.com/jquery-1.11.3.js"></script>
<!-- 타임리프 -->
<html xmlns:th="http://www.thymeleaf.org">
<!-- 페이징 눼이쉔~ -->
<link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
<script type="text/javascript" src="https://uicdn.toast.com/tui.code-snippet/v1.5.0/tui-code-snippet.js"></script>
<script type="text/javascript" src="https://uicdn.toast.com/tui.pagination/v3.3.0/tui-pagination.js"></script>
<script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.js"></script>
<style>
	.input-group{
		width: 200px;
	}
	.btn_container{
		width: 100%;
	}
	.addContainer{
		width: 40%;
		height: 450px;
		border: 1px solid black;
		padding: 20px;
		float: left;
	}
	.plan_monitor{
		width: 60%;
		height: 450px;
		border: 1px solid black;
		padding: 20px;
		float: left;
	}
	#plan_search1{
		width: 40%;
		height: 100%;
		float: left;
	}
	#plan_search2{
		width: 58%;
		height: 500px;
		float: left;
		margin-left: 20px;
	}
	.bom_monitor{
		width: 60%;
		height: 450px;
		border: 1px solid black;
		padding: 20px;
		float: left;
		display: none;
	}
	#left_search{
		width: 48%;
		height: 100%;
		float: left;
		text-align: right;
	}
	#right_search{
		width: 50%;
		height: 500px;
		float: left;
		margin-left: 20px;
		text-align: right;
	}
	
</style>
</head>
<body>
	<div layout:fragment="content">
	<h1 class="mt-4" style="font-family: 'MaruBuri';">작업지시 관리</h1>
	<hr>
	<div class="btn_container">
		<button class="plusBtn sixBtn4">+</button>
		<button class="moveBtn sixBtn4">이동</button>
		<button class="removeBtn sixBtn4">삭제</button>
		<button class="planBtn sixBtn4">생산계획</button>
		<button class="bomBtn sixBtn4">공정등록</button>
	</div>
	<div class="addContainer">
	
	<table>
	<tr>
		<td>
			<div class="input-group mb-3">
			  <input type="text" class="form-control" id="orderCodeInput" placeholder="지시코드" aria-label="Recipient's username" aria-describedby="button-addon2" readonly>
			</div>
		</td>
		<td>
			<div class="input-group mb-3">
			  <input type="text" class="form-control" placeholder="담당자" aria-label="Recipient's username" aria-describedby="button-addon2">
			  <button class="btn btn-outline-secondary" type="button" id="button-addon2">Button</button>
			</div>
		</td>
		<td>
			<div class="input-group mb-3">
			  <input type="text" class="form-control" placeholder="등록일" aria-label="Recipient's username" aria-describedby="button-addon2">
			  <button class="btn btn-outline-secondary" type="button" id="button-addon2">Button</button>
			</div>
		</td>
	</tr>
	<tr>
		<td>
			<div class="input-group mb-3">
			  <input type="text" class="form-control" placeholder="작업지시 상태" aria-label="Recipient's username" aria-describedby="button-addon2">
			  <button class="btn btn-outline-secondary" type="button" id="button-addon2">Button</button>
			</div>
		</td>
		<td>	
			<div class="input-group mb-3">
			  <input type="text" class="form-control" placeholder="생산계획 검색" aria-label="Recipient's username" aria-describedby="button-addon2">
			  <button class="btn btn-outline-secondary" type="button" id="button-addon2">Button</button>
			</div>
		</td>
	</tr>
	</table>
	<div class="input-group mb-3">
	  <select class="form-select" id="inputGroupSelect01">
	    <option selected>상태</option>
	    <option value="1">진행중</option>
	    <option value="2">완료</option>
	    <option value="3">취소</option>
	  </select>
	</div>
	
	
	</div>
	
	<div class="plan_monitor">
		<div id="plan_search1"></div>
		<div id="plan_search2"></div>
	</div>
	<div class="bom_monitor">
		<div id="left_search">
			<button class="plusBomBtn sixBtn1">+</button>
			<button class="delBomBtn sixBtn1">-</button>
			<div id="bom_search1"></div>
		</div>
		
		<div id="right_search">
			<button class="plusMatBtn sixBtn1">+</button>
			<button class="delMatBtn sixBtn1">-</button>
			<div id="bom_search2"></div>
		</div>
	</div>
	
	
	<!-- <button class="modal_btn sixBtn4">모달버튼</button> -->
	생산계획
	<div id="grid1"></div>
	
	공정조회
	<div id="grid2"></div>
	
	<!-- 모달창 -->
					<div class="modal fade" id="product_modal" tabindex="-1"
						aria-labelledby="exampleModalLabel" aria-hidden="true">
						<div class="modal-dialog modal-lg">
						<div class="modal-dialog">
							<div class="modal-content">
							
								<!-- 모달안 데이터입력 -->
								<div class="modal-header">
									<h1 class="modal-title fs-5" id="searchModalLabel">제품 조회</h1>
									<button type="button" class="btn-close" data-bs-dismiss="modal"
										aria-label="Close"></button>
								</div>
								
								<div class="btns">
			  						제품명:  <input id="search-text"/>
			 					 <button class="sixBtn2"  id="search-btn">조회</button>
			  					<button class="sixBtn2"   id="reset-btn">초기화</button>
								</div>
								
								<div class="modal-body">
									<div id="grid_product"></div>
								</div>
								<!-- 모달안 데이터입력 끝-->
								
							</div>
						</div>
					</div>
				   </div>
	<!-- 공정조회 모달창 -->
					<div class="modal fade" id="process_modal" tabindex="-1"
						aria-labelledby="exampleModalLabel" aria-hidden="true">
						<div class="modal-dialog modal-lg">
						<div class="modal-dialog">
							<div class="modal-content">
							
								<!-- 모달안 데이터입력 -->
								<div class="modal-header">
									<h1 class="modal-title fs-5" id="searchModalLabel">공정 조회</h1>
									<button type="button" class="btn-close" data-bs-dismiss="modal"
										aria-label="Close"></button>
								</div>
								
								<div class="btns">
			  						제품명:  <input id="search-text"/>
			 					 <button class="sixBtn2"  id="search-btn">조회</button>
			  					<button class="sixBtn2"   id="reset-btn">초기화</button>
								</div>
								
								<div class="modal-body">
									<div id="grid_process"></div>
								</div>
								<!-- 모달안 데이터입력 끝-->
								
							</div>
						</div>
					</div>
				   </div>
   <!-- 자재조회 모달창 -->
					<div class="modal fade" id="mat_modal" tabindex="-1"
						aria-labelledby="exampleModalLabel" aria-hidden="true">
						<div class="modal-dialog modal-lg">
						<div class="modal-dialog">
							<div class="modal-content">
							
								<!-- 모달안 데이터입력 -->
								<div class="modal-header">
									<h1 class="modal-title fs-5" id="searchModalLabel">자재 조회</h1>
									<button type="button" class="btn-close" data-bs-dismiss="modal"
										aria-label="Close"></button>
								</div>
								
								<div class="btns">
			  						제품명:  <input id="search-text"/>
			 					 <button class="sixBtn2"  id="search-btn">조회</button>
			  					<button class="sixBtn2"   id="reset-btn">초기화</button>
								</div>
								
								<div class="modal-body">
									<div id="grid_mat"></div>
								</div>
								<!-- 모달안 데이터입력 끝-->
								
							</div>
						</div>
					</div>
				   </div>
				   
	<script th:inline="javascript">
    // Thymeleaf에서 값을 가져와서 JavaScript 변수에 할당
    var orderCode = /*[[${orderCode}]]*/ '';

    // JavaScript를 사용하여 placeholder 값을 설정
    document.getElementById("orderCodeInput").placeholder = orderCode;
    
</script>	   
	
	<script>
	
	
	{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}
	
	var grid1 = new tui.Grid({
	    el: document.getElementById('grid1'),
	    scrollX: false,
	    scrollY: false,
	    rowHeaders: ['rowNum','checkbox'],
	    columns: [
    	  {
 	        header: '세부코드',
 	        name: 'wkDetaId'
 	      },
 	      {
 	        header: '제품코드',
 	        name: 'cpId',
 	        editor: 'text'
 	      },
 	      {
 	        header: '제품명',
 	        name: 'cpName'
 	      },
 	      {
 	        header: '지시수량',
 	        name: 'ordQt',
 	        editor: 'text'
 	      },
 	      {
 	        header: '양품수량',
 	        name: 'ordQt',
 	        editor: 'text'
 	      },
 	      {
 	        header: '작업일',// 아직VO에 없음 정의못했음
 	        name: 'startDate',
 	        editor: 'datePicker'
 	      },
 	      {
 	        header: '종료일',// 아직VO에 없음 정의못했음
 	        name: 'endDate',
 	        editor: 'datePicker'
 	 	  },
	 	 	{
		          header: '진행현황',
		          name: 'cmpltSt',
			      editor: {
			    	  type: 'select',
			            options: {
			              listItems: [
			                { text: '진행중', value: '진행중' },
			                { text: '취소', value: '취소' },
			                { text: '대기', value: '대기' },
			                { text: '완료처리', value: '완료처리' },
			                { text: '생산완료', value: '생산완료' }
			              ]
			            }
			     }
		       }
	    ],
	    pageOptions: {
	        useClient: true,
	        perPage: 8
	      }
	  });
	
	
	
	{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}
	
	
	var grid2 = new tui.Grid({
	    el: document.getElementById('grid2'),
	    scrollX: false,
	    scrollY: false,
	    rowHeaders: ['rowNum'],
	    
	    columns: [
	      
	      {
	        header: '주문코드',
	        name: 'ordId'
	       
	      },
	      {
	        header: '거래처코드',
	        name: 'busId'
	      },
	      {
	        header: '거래처',
	        name: 'busName'
	      },
	      {
	        header: '납기일',
	        name: 'ordEndDate'
	      },
	      {
	        header: '주문일',
	        name: 'ordDate'
	      },
	      {
	        header: '주문상태',
	        name: 'ordStat'
	      }
	    ],
	    pageOptions: {
	        useClient: true,
	        perPage: 8
	      }
	  });
	
	
	let data = []
	
	for(let i=0;i<9;i++){
		data.push({})
	}
	var plan_search1 = new tui.Grid({
	    el: document.getElementById('plan_search1'),
	    data : data,
	    scrollX: false,
	    scrollY: false,
	    rowHeaders: ['rowNum'],
	    
	    columns: [
	      
 	      {
 	        header: '계획코드',
 	        name: 'planHeadId'
 	      },
 	      {
 	        header: '분류',
 	        name: 'type'
 	      },
 	      {
 	        header: '예상시작일',
 	        name: 'planStart',
 	      },
 	      {
 	        header: '예상종료일',
 	        name: 'planEnd',
 	 	  },
 	 	  {
 	        header: '상태',// 아직VO에 없음 정의못했음
 	        name: 'cmpltSt',
 	 	  }
	 	 	
	    ],
	    pageOptions: {
	        useClient: true,
	        perPage: 8
	      }
	  });
		//첫 페이지에서 뜨는 데이터
		window.onload = function(){
			
			$.ajax({
				url : "/ajax/getPlanList",
				method : "GET",
				dataType : "JSON",
				success : function(result){
					console.log("첫 출력값 > ")
					console.dir(result);
					plan_search1.resetData(result);
				}
			})
			
			
		}
		//생산계획 리스트 클릭시 세부생산계획이 표시됨
		plan_search1.on('click', ev => {
		let data = plan_search1.getRow(ev.rowKey).planHeadId;
		console.log(data);
		$.ajax({
			url : "/ajax/getDetaPlanList",
			method : "GET",
			dataType : "JSON",
			data : { planHeadId: data},
			success : function(result){
				console.log("첫 출력값 > ")
				console.dir(result);
				while (result.length < 8){
					result.push({});
				}
				plan_search2.resetData(result);
			},
			error : function(reject){
				console.log(reject);
			}
		})
	})
	
	var plan_search2 = new tui.Grid({
	    el: document.getElementById('plan_search2'),
	    data : data,
	    scrollX: false,
	    scrollY: false,
	    rowHeaders: ['rowNum','checkbox'],
	    
	    columns: [
	      
 	      {
 	        header: '세부코드',
 	        name: 'planDetaId'
 	      },
 	      {
 	        header: '제품코드',
 	        name: 'cpId'
 	      },
 	      {
 	        header: '제품명',
 	        name: 'cpName'
 	      },
 	      {
 	        header: '계획수량',
 	        name: 'detaQt'
 	      },
 	      {
 	        header: '기 지시량',
 	        name: 'ordQt',
 	      },
 	 	  {
 	        header: '종결',// 아직VO에 없음 정의못했음
 	        name: 'cmpltSt',
 	 	  }
	 	 	
	    ],
	    pageOptions: {
	        useClient: true,
	        perPage: 8
	      }
	  });
		
		let bom_data = []
		bom_data.push({
			procId : '',
			procType : '',
			procName : ''
		})
	var bom_search1 = new tui.Grid({
	    el: document.getElementById('bom_search1'),
	    data : bom_data,
	    scrollX: false,
	    scrollY: false,
	    rowHeaders: ['rowNum','checkbox'],
	    
	    columns: [
	      
 	      {
 	        header: '공정코드',
 	        name: 'procId'
 	      },
 	      {
 	        header: '공정구분',
 	        name: 'procType'
 	      },
 	      {
 	        header: '공정명',
 	        name: 'procName',
 	      }
	 	 	
	    ],
	    pageOptions: {
	        useClient: true,
	        perPage: 8
	      },
	      draggable: true
	  });
		
		let mat_data = []     ///재수정 요망 !!!!!!
		mat_data.push({})
		var bom_search2 = new tui.Grid({
		    el: document.getElementById('bom_search2'),
		    data : data,
		    scrollX: false,
		    scrollY: false,
		    rowHeaders: ['rowNum'],
		    
		    columns: [
		      
	 	      {
	 	        header: '계획코드',
	 	        name: 'planHeadId'
	 	      },
	 	      {
	 	        header: '분류',
	 	        name: 'type'
	 	      },
	 	      {
	 	        header: '예상시작일',
	 	        name: 'planStart',
	 	      },
	 	      {
	 	        header: '예상종료일',
	 	        name: 'planEnd',
	 	 	  },
	 	 	  {
	 	        header: '상태',// 아직VO에 없음 정의못했음
	 	        name: 'cmpltSt',
	 	 	  }
		 	 	
		    ],
		    pageOptions: {
		        useClient: true,
		        perPage: 8
		      }
		  });
	
	{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}
	//버튼 관련
	
	let selectDetWorkCode = ''
	let selectBomWorkCode = ''
	
	//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료
	//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료
	$('.plusBtn').on('click', function(){
		let WorkCode = document.getElementById("orderCodeInput").placeholder 
		$.ajax({
				url : "/ajax/addDetaWork",
				method : "GET",
				dataType : "JSON",
				contentType: "application/json",
				data : { data: WorkCode },
				success : function(result){
					console.dir(result);
					grid1.resetData(result);
					},
					errer : function(reject){
						console.log(reject)
					}
				})
	})
	//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료
	//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료
	
	
	
	let grid1_unique_code = 10;
	
	grid1_data = []
	$('.moveBtn').on('click', function(){
 		var appendedData = plan_search2.getCheckedRows()
 		let count = 0;
 		for(let i of appendedData){
 			console.log(i)
 			let swith = false;
 			if(grid1.getData().length > 0){
 				for(let j of grid1.getData()){
 					if(j.planDetaId == i.planDetaId && swith == false && j.planDetaId != null){
 						console.log('일치 하였음')
 						count += 1;
 						swith = true;
 					}
 				}	
				if(swith == false){
					grid1_data.push(i)
	 	 			plan_search2.uncheck(i.rowKey, 'checkbox');
	 	 			swith = false;
				}
 			}else{
				grid1_data.push(i)
 	 			plan_search2.uncheck(i.rowKey, 'checkbox');
 			}
 		}
 		if(count >0){
 			alert('중복되는 세부계획이 존재합니다')
 		}
 		
 		grid1.resetData(grid1_data);
 		console.log(appendedData)
	 	//grid4.removeCheckedRows(false);
 		plan_search2.blur();
 	})
	
	$('.planBtn').on('click', function(){
		$('.plan_monitor').css('display', 'block')	
		$('.bom_monitor').css('display', 'none')
	})
	
	$('.bomBtn').on('click', showBom)
	function showBom(){
		$('.plan_monitor').css('display', 'none')
		$('.bom_monitor').css('display', 'block')
		setTimeout(() =>
	    (bom_search1.refreshLayout(), 200),
	    (bom_search2.refreshLayout(), 200))
    }
	
	//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료
	//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료
	grid1.on('click',ev => {
		let columnName = ev.columnName;
		if (columnName === 'cpId'){ //컬럼이름 변경하 시오!
			console.log(ev.columnName);
		    console.log(ev.columnIndex);
			$('#product_modal').modal('show');
			//특정 Cell의 열,컬럼이름 데이터
			cell = grid1.getFocusedCell(ev.rowKey, ev.columnName);
			//특정 Cell의 데이터 변경 //나중에 제품클릭후 작동되는 함수로 옮길거임
			setTimeout(() =>
		    grid_product.refreshLayout(), 200);
		}
		//클릭한 세부지시에 대한 공정가져오기
		selectDetWorkCode = grid1.getRow(ev.rowKey).wkDetaId;
		$.ajax({
			url : "/ajax/getWkBomList",
			method : "GET",
			dataType : "JSON",
			contentType: "application/json",
			data : { data: selectDetWorkCode },
			success : function(result){
				console.dir(result);
				bom_search1.resetData(result);
				},
				errer : function(reject){
					console.log(reject)
				}
			})
		showBom()
		selectBomWorkCode = '';
	})
	
	// 공정조회 모달창
	bom_search1.on('click',ev => {
		let columnName = ev.columnName;
		selectBomWorkCode = ev.rowKey;
		if (columnName === 'procId'){ 
			$('#process_modal').modal('show');
			//특정 Cell의 데이터 변경 //나중에 제품클릭후 작동되는 함수로 옮길거임
			setTimeout(() =>
			grid_process.refreshLayout(), 200);
		}
		$.ajax({
			url : "/ajax/getWkMatList",
			method : "GET",
			dataType : "JSON",
			contentType: "application/json",
			data : { data: bom_search1.getRow(selectBomWorkCode).wkBomId},
			success : function(result){
				console.dir(result);
				bom_search2.resetData(result);
				},
				errer : function(reject){
					console.log(reject)
				}
			})
	})
	
	$('.plusBomBtn').on('click', function(){
		if(세부계획선택여부() == true){
			$.ajax({
				url : "/ajax/plusBomList",
				method : "GET",
				dataType : "JSON",
				contentType: "application/json",
				data : { data: selectDetWorkCode },
				success : function(result){
					console.dir(result);
					bom_search1.resetData(result);
					},
					errer : function(reject){
						console.log(reject)
					}
				})
		}
	})
	
	$('.delBomBtn').on('click', function(){
		if(세부계획선택여부() == true){
			let removeReady = bom_search1.getCheckedRows();
			console.log(removeReady);
			$.ajax({
				url : "/ajax/delBomList",
				method : "POST",
				dataType : "JSON",
				contentType: "application/json",
				data :  JSON.stringify(removeReady),
				success : function(result){
					console.dir(result);
					bom_search1.resetData(result);
					selectBomWorkCode = '';
					},
					errer : function(reject){
						console.log(reject)
					}
				})
			
		}
	})
	
	$('.plusMatBtn').on('click', function(){
		if(공정코드선택여부() == true){
			$.ajax({
				url : "/ajax/plusMatList",
				method : "GET",
				dataType : "JSON",
				contentType: "application/json",
				data : { data: bom_search1.getRow(selectBomWorkCode).wkBomId },
				success : function(result){
					console.dir(result);
					bom_search2.resetData(result);
					},
					errer : function(reject){
						console.log(reject)
					}
				})
		}
	})
	$('.delMatBtn').on('click', function(){
		if(공정코드선택여부() == true){
			let removeReady = bom_search2.getCheckedRows();
			console.log(removeReady);
			$.ajax({
				url : "/ajax/delMatList",
				method : "POST",
				dataType : "JSON",
				contentType: "application/json",
				data :  JSON.stringify(removeReady),
				success : function(result){
					console.dir(result);
					bom_search2.resetData(result);
					},
					errer : function(reject){
						console.log(reject)
					}
				})
		}
	})
	//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료
	//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료//검증완료
	
	
	$('.removeBtn').on('click', function(){
		let removeReady = grid1.getCheckedRows();
		console.log(removeReady);
		$.ajax({
			url : "/ajax/delDetWorkList",
			method : "POST",
			dataType : "JSON",
			contentType: "application/json",
			data :  JSON.stringify(removeReady),
			success : function(result){
				console.dir(result);
				grid1.resetData(result);
				bom_search1.resetData();
				bom_search2.resetData();
				selectDetWorkCode = '';
				},
				errer : function(reject){
					console.log(reject)
				}
			})
	})
	
	
	//모달안에 그리드중 데이터클릭시 작동. 모달닫히는거까지
	grid_product.on('click',ev => {
		let cpId = grid_product.getRow(ev.rowKey).cpId
		let cpName = grid_product.getRow(ev.rowKey).cpName
		console.log('들어가는 데이터 : ' + cpId + '  ' + cpName)
		grid1.setValue(cell.rowKey, 'cpId', cpId)
		grid1.setValue(cell.rowKey, 'cpName', cpName)
		$('#product_modal').modal('hide');
	})
	
	let target
	
	
	//모달안에 그리드중 데이터클릭시 작동. 모달닫히는거까지
	grid_process.on('click',ev => {
		console.log(cell.rowKey)
		let procId = grid_process.getRow(ev.rowKey).procId
		let procType = grid_process.getRow(ev.rowKey).procType
		let procName = grid_process.getRow(ev.rowKey).procName
		let process_obj = {
			procId : procId,
			procType : procType,
			procName : procName,
			
		}
		if(cell.rowKey == bom_data.length-1){ //일치할 경우 새로운 행이 추가됨
			let point = bom_data.length-1
			process_obj.uniqueCode = bom_search1.getRow(point).uniqueKey
			bom_data = bom_search1.getData();
			bom_data.pop();
			bom_data.push(process_obj)
			bom_data.push({})
			bom_search1.resetData(bom_data);
			console.log('newuniqueKey : ' + process_obj.uniqueCode)
			$('#process_modal').modal('hide');
			
			//각 공정마다 제품정보 받아줄수 있게 방 만들어주기 !!
			mat_ary.push({
				uniqueCode : process_obj.uniqueCode,
				ary : [{
					matName : '',
					matSize : '',
					matQt : '',
					type : ''
				}]
			})
		}else{ //일치하지 않는다면, 수정하겠다는 의도임
			bom_search1.setValue(cell.rowKey, 'procId', procId)
			bom_search1.setValue(cell.rowKey, 'procType', procType)
			bom_search1.setValue(cell.rowKey, 'procName', procName)
			$('#process_modal').modal('hide');
		}
	})
	
	let mat_ary = []
	// 자재 모달창
	bom_search2.on('click',ev => {
		
		let columnName = ev.columnName;
		
		if (columnName === 'matId' || columnName === 'matName' || columnName === 'matQt'){ //컬럼이름 변경하 시오!
			console.log(ev.columnName);
		    console.log(ev.columnIndex);
			$('#mat_modal').modal('show');
			//특정 Cell의 열,컬럼이름 데이터
			cell = bom_search2.getFocusedCell(ev.rowKey, ev.columnName);
			//특정 Cell의 데이터 변경 //나중에 제품클릭후 작동되는 함수로 옮길거임
			setTimeout(() =>
			grid_mat.refreshLayout(), 200);
		}
	})
	
	//모달안에 그리드중 데이터클릭시 작동. 모달닫히는거까지
	grid_mat.on('click',ev => {
		let matName = grid_mat.getRow(ev.rowKey).matName
		let matSize = grid_mat.getRow(ev.rowKey).matSize
		let type = grid_mat.getRow(ev.rowKey).type
		bom_search2.setValue(cell.rowKey, 'matName', matName)
		bom_search2.setValue(cell.rowKey, 'matSize', matSize)
		bom_search2.setValue(cell.rowKey, 'type', type)
		$('#mat_modal').modal('hide');
	})
	
	
	///////////////////함수저장소//////////////////
	
	function 세부계획선택여부(){
		if(selectDetWorkCode === ''){
			alert('작업지시를 먼저 선택하세요')
			return false
		}else{
			return true
		}
	}
	
	function 공정코드선택여부(){
		if(selectBomWorkCode === ''){
			alert('공정을 먼저 선택하세요')
			return false
		}else{
			return true
		}
	}
	
	
	
	
	
	
	tui.Grid.applyTheme('default', {
        cell: {
            header: {
                background: '#e5edf5'
            },
            rowHeader: {
                background: '#e5edf5'
            },
            normal: {
                background: '#ffffff'
            }
        }
    });
	
	
	
	
	</script>
	
	</div>
</body>
</html>