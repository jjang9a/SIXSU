<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/template}">

<head>
<meta charset="UTF-8">
<title>주문서관리</title>

</head>


<body>
	<div layout:fragment="content">
		<h1 class="mt-4" style="font-family: 'MaruBuri';">주문서등록</h1>
		<div id="left">
			주문번호 <input type="text" id="codeBox"><button class="sixBtn2" id= "makeCode">생성 <svg xmlns="http://www.w3.org/2000/svg" width="14" height="18"
                            fill="currentColor" class="bi bi-search" viewBox="0 2 16 16"></svg></button>
			<br> 주문날짜 <input type="text" id="currentDate"><br>
			
			주문자 <input type="text" id="orderName">

			<button type="button" data-bs-toggle="modal" id="searchBtn"
				 class="sixBtn2" data-bs-target="#searchModal">
				<svg xmlns="http://www.w3.org/2000/svg" width="14" height="18" fill="currentColor" class="bi bi-search" viewBox="0 2 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                </svg>
			</button>
			<br> 사원번호 <input type="text" id="orderNum"><br>
		</div>

		<div id="right">
			거래처명 <input type="text" id="busName">
			<button type="button" data-bs-toggle="modal" id="search1Btn" class="sixBtn2" data-bs-target="#search1Modal">
			<svg xmlns="http://www.w3.org/2000/svg" width="14" height="18" fill="currentColor" class="bi bi-search" viewBox="0 2 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
            </svg>
			</button>
			<br> 거래처코드 <input type="text" id="busCode">
			<br> 사업자번호 <input type="text" id="busNum">
			<br> 주소 <input type="text" id="busAddr">
			<br> 전화번호 <input type="text" id="busTel">
		</div>

		<div id="bottom">
			<button  class="sixBtn2" id="confirm">등록</button>
			<button class="sixBtn2">삭제</button>
			<button class="sixBtn2">수정</button>
		</div>


								<!-- 모달창 사원조회 -->
								<div class="modal fade" id="searchModal" tabindex="-1"
									aria-labelledby="exampleModalLabel" aria-hidden="true">
									<div class="modal-dialog modal-lg">
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header">
												<h1 class="modal-title fs-5" id="searchModalLabel">사원 조회</h1>
												<button type="button" class="btn-close" data-bs-dismiss="modal"
													aria-label="Close"></button>
											</div>
											
										
											<div class="btns">
						  						사원이름:  <input id="search-text"/>
						 					 <button class="sixBtn2"  id="search-btn">조회</button>
						  					<button class="sixBtn2"   id="reset-btn">초기화</button>
											</div>
											
											<div class="modal-body">
												<div id="grid"></div>
											</div>
										</div>
									</div>
								</div>
							   </div>
								<!-- 모달창 거래조회  -->
								<div class="modal fade" id="search1Modal" tabindex="-1"
									aria-labelledby="exampleModalLabel" aria-hidden="true">
										<div class="modal-dialog modal-lg">
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header">
												<h1 class="modal-title fs-5" id="searchModalLabel">거래처 조회</h1>
												<button type="button" class="btn-close" data-bs-dismiss="modal"
													aria-label="Close"></button>
											</div>
						                    <div class="btns">
						  						거래처명:  <input id="search1-text"/>
						 					 <button class="sixBtn2"  id="search1-btn">조회</button>
						  					<button class="sixBtn2"   id="reset1-btn">초기화</button>
											</div>
											<div class="modal-body">
												<div id="gridt"></div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div id="gridy"></div>	
							<button id="delete"> 삭제</button>
<script>
	// 모달창 전체 사원 리스트
	
	window.onload = function() {
		$.ajax({
			url : "/sales/empList",
			method : "GET",
			dataType : "JSON",
			success : function(result) {
				grid.resetData(result);
			}
		});
		$('#searchModal').on('show.bs.modal',function(e){
			console.log ('사원 모달');
			setTimeout(()=>grid.refreshLayout(),1000);
		})
		
		
		
	//모달창 전체 거래처 리스트
		$.ajax({
			url : "/sales/busList",
			method : "GET",
			dataType : "JSON",
			success : function(result) {
				gridt.resetData(result);
			}
		});
		$('#search1Modal').on('show.bs.modal',function(e){
			console.log ('거래처 모달');
			setTimeout(()=>gridt.refreshLayout(),1000);
		})	
		
		
	// 상세주문등록 테이블 리스트
		$.ajax({
			url : "/sales/ordList",
			method : "GET",
			dataType : "JSON",
			success : function(result) {
				gridy.resetData(result);
			}
		});
		$("#confirm").on("click", function(e) {
	  		if ($('#currentDate').val() === "" || $('#orderName').val() === "" || $('#busName').val() === "") {
	    	alert("모든 항목에 입력을 하십시오");
	  		}else {
	  			gridy.appendRow();
	  			
	  		}
	  		})
	  	
	};
	//
	$("#delete").on("click", function(e) {	
	  		gridy.removeCheckedRows(false)})
	  		
	  		
	const gridy = new tui.Grid({
		el : document.getElementById('gridy'),
		//data : gridData,
		scrollX : false,
		scrollY : false,
		
		 rowHeaders: ['checkbox','rowNum'],
		columns : [ {
			header : '완제품명',
			
		}, {
			header : '완제품코드',
		
		},{
			header : '규격',
		
		},{
			header : '주문수량',
		
		},
		  {
			header : '상품가격',
		
		},
		 {
			header : '총가격',
		
		},
		{
			header : '납기일자',
		
		},
		{
			header : '출고여부',
		
		}
		]
	});
	
	//모달창 전체 사원 리스트
	const grid = new tui.Grid({
		el : document.getElementById('grid'),
		//data : gridData,
		scrollX : false,
		scrollY : false,
		columns : [ {
			header : '사원번호',
			name : 'empId',
		}, {
			header : '사원이름',
			name : 'empName'
		}, {
			header : '사원직책',
			name : 'empRk'
		}
		]
	});
    // 모달창 사원조회 기능
		$("#search-btn").on('click', function(){
			console.log($("#search-text").val())
			const result = $("#search-text").val()
			
			
			$.ajax({
				url : "/sales/emp1List",
				method : "GET",
				data : {'result' : result},
				success : function(result) {
					grid.resetData(result);
					  $("#search-text").val("");
				},
				error : function(reject){
					console.log(reject);
				}
			});
			$('#searchModal').on('show.bs.modal',function(e){
				console.log ('사원 모달');
				setTimeout(()=>grid.refreshLayout(),1000);
			})
		})
	// 모달창 사원조회 입력값 초기화
		$('#reset-btn').on('click',function(e){
			$.ajax({
				url : "/sales/empList",
				method : "GET",
				dataType : "JSON",
				success : function(result) {
					grid.resetData(result);
				}
			});
		})
    // 모달창 사원행 클릭시 자동으로 주문등록페이지에 값이 입력이됨
	grid.on('click', ev=> {
      const focusCell = grid.getFocusedCell()
 

      let dataRow = grid.getRow(ev.rowKey);
      
      
      $('#orderName').val(dataRow.empName);
      $('#orderNum').val(dataRow.empId);
     
      $('#searchModal').modal('hide');
    })   
     
 

   


    // 모달창 거래처조회 기능
	const gridt = new tui.Grid({
		el : document.getElementById('gridt'),
		//data : gridData,
		scrollX : false,
		scrollY : false,
		columns : [ 
			{
			header : '거래처번호',
			name : 'busId',
		}, {
			header : '거래처명',
			name : 'busName'
		}, {
			header : '사업자번호',
			name : 'busNum'
		}, {
			header : '전화번호',
			name : 'busTell'
		}, {
			header : '주소',
			name : 'busAddr'
		}]
	});
		 // 모달창 사원조회 기능
		$("#search1-btn").on('click', function(){
			console.log($("#search1-text").val())
			const result = $("#search1-text").val()
			$.ajax({
				url : "/sales/bus1List",
				method : "GET",
				data : {'result' : result},
				success : function(result) {
					gridt.resetData(result);
					  $("#search-text1").val("");
				},
				error : function(reject){
					console.log(reject);
				}
			});
		})
	// 모달창 거래처조회 입력값 초기화
	  	$("#reset1-btn").on('click',function(e){
	  		$.ajax({
				url : "/sales/busList",
				method : "GET",
				dataType : "JSON",
				success : function(result) {
					gridt.resetData(result);
				}
			});   
    })
      // 모달창 거래처행 클릭시 자동으로 주문등록페이지에 값이 입력이됨
	gridt.on('click', ev=> {
      const focusCell = gridt.getFocusedCell()
      let dataRow = gridt.getRow(ev.rowKey);
      $('#busName').val(dataRow.busName);
      $('#busCode').val(dataRow.busId);
      $('#busNum').val(dataRow.busNum);
      $('#busAddr').val(dataRow.busAddr);
      $('#busTel').val(dataRow.busTell);
      $('#search1Modal').modal('hide');
    })   
     
     //	주문서번호 생성을 누르면 자동으로 주문서 번호와 오늘의 날짜가 뜨도록 만드는 기능
    $("#makeCode").on('click', function(){
    	$.ajax({
			url : "/sales/makeCode",
			method : "GET",
			success : function(result) {
				
				console.log(result);
				
			 $('#codeBox').val(result);
			}
    	});
    	date = new Date();
    	year = date.getFullYear();
    	month = date.getMonth() + 1;
    	day = date.getDate();
    	$('#currentDate').val(year + "-" + month + "-" + day);
    })
  	
  
    
    
</script>

	</div>
</body>
</html>