<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/template}">

<head>
<meta charset="UTF-8">
<title>출고관리</title>
</head>
<body>
	<div layout:fragment="content">
<h1 class="mt-4" style="font-family: 'MaruBuri';">출고관리</h1>
<h3 class="mt-4" style="font-family: 'MaruBuri';">주문현황</h3>
 상품명 <input type="text" name="cpName" id="cpNameBox">
		<button type="button" data-bs-toggle="modal" id="searchProductBtn"
						class="sixBtn1" target="#searchModal">
						<svg xmlns="http://www.w3.org/2000/svg" width="14" height="18"
							fill="currentColor" class="bi bi-search" viewBox="0 2 16 16">
                <path
								d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                </svg>
					</button><br>
	 상품코드 <input type="text" name="cpId" id="cpIdBox"> <br>
	 입고일자 <input type="date" name="startPro" id="startPro"> <input type="date" name="endPro" id="endPro"> <br>
	 <button class="sixBtn2" id="infoCollect">조회</button>
	 <button class="sixBtn4" id="infoCollect">초기화</button><BR>
	 
	 <div id="orderListGrid"></div>
					
					
					
	<!-- 상품목록 모달창 -->				
		<div class="modal fade" id="productModal" tabindex="-1"
			aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="searchModalLabel">상품 목록 조회</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>


						<div class="btns"></div>

						<div class="modal-body">
							<div id="gridp"></div>
						</div>
					</div>
				</div>
			</div>
		</div>	
<script>
//상품조회 모달창 부분
	$("#searchProductBtn").on('click', function(e){
	$('#productModal').modal('show');
	 $.ajax({
    		url : "/sales/products",
    		method : "get",
    		dataType : "JSON",
    		success : function(result){
    			gridp.resetData(result);
    			console.log ('거래처 모달');
    			setTimeout(()=>gridp.refreshLayout(),1000);
    		}
    	})
	})
		const gridp = new tui.Grid({
		el : document.getElementById('gridp'),
		//data : gridData,
		scrollX : false,
		scrollY : false,
		pageOptions: {
			useClient: true,
			perPage: 10
		},
		columns : [ {
			header : '완제품 코드',
			name : 'cpId',
		}, {
			header : '완제품 이름',
			name : 'cpName'
		}, {
			header : '완제품 규격',
			name : 'cpSize'
		}
		]
	});	
	gridp.on('click', ev=>{
		const focusCell = gridp.getFocusedCell()
		let dataRow = gridp.getRow(ev.rowKey);
		$('#cpNameBox').val(dataRow.cpName);
		$('#cpIdBox').val(dataRow.cpId);
		$('#productModal').modal('hide');
	})
	
	
	
	//주문상세목록 띄우기
	const orderListGrid = new tui.Grid({
		el : document.getElementById('orderListGrid'),
		//data : gridData,
		scrollX : false,
		scrollY : false,
		pageOptions: {
			useClient: true,
			perPage: 10
		},
		columns : [ {
			header : '주문날짜',
			name : 'ordDate',
		},{
			header : '납기일자',
			name : 'ordEndDate'
		}, {
			header : '주문코드',
			name : 'ordId'
		}, {
			header : '주문상세코드',
			name : 'ordDetId'
		}, {
			header : '제품코드',
			name : 'cpId'
		}, {
			header : '제품명',
			name : 'cpName'
		}, {
			header : '주문수량',
			name : 'ordQt'
		}
		]
	});	
	 $.ajax({
 		url : "/sales/orderedList",
 		method : "get",
 		dataType : "JSON",
 		success : function(result){
 			orderListGrid.resetData(result);
 			console.log ('출고대기 주문서들');
 			setTimeout(()=>orderListGrid.refreshLayout(),1000);
 		}
 	})
	
			
</script>	
	</div>
</body>
</html>